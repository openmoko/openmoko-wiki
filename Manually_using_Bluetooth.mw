{{InProgress}}
Bluetooth is one of the core functions of the Neo1973, however it is basically unimplemented on the software side at the moment.
Hardware problems in the P1 phone mean that the CPU has to be active in order to wake on external bluetooth events, which will reduce the battery life to some 2 days at best in standby.

This page details how to use bluetooth from the command line.
We have quite a lot of plans about what exactly Bluetooth should be used for.

== Power it up ==

Bluetooth may not be powered up.

Power up the adapter:

 root@fic-gta01:~$ echo "1" > /sys/bus/platform/devices/gta01-pm-bt.0/power_on

If that doesn't do it, power up and reset the adapter one after the other:

 root@fic-gta01:~$ echo "1" > /sys/bus/platform/devices/gta01-pm-bt.0/power_on ; 
 echo "1" > /sys/bus/platform/devices/gta01-pm-bt.0/reset ;
 echo "0" > /sys/bus/platform/devices/gta01-pm-bt.0/reset

hciconfig should print information about the adapter if it is connected to usb:

 hciconfig

(If you have an older rootfs, you may need to modprobe gta01-pm-bt or even hci_usb but these are built in/loaded automatically currently.)

== Bluetooth Functions ==

=== passkey agent example ===

There should be a passkey agent built into openmoko, but for now you can start up the example passkey agent and set the pin code there. This will allow for new pairings to be made when you attempt a connection.

 passkey-agent --default 0000 &

=== HID (Human Input Device) ===

==== Being able to use HID devices ====

We want to be able to use a bluetooth keyboard to type into the various applications of our Neo1973.
To use a Bluetooth Keyboard type: (11:22:33:44:55:66 is the Address of your BT-Keyboard)

 hidd --connect 11:22:33:44:55:66

and press "Connect" on your BT-KB (tested on a Logitech Dinovo Edge)


==== Acting as HID device ====

We want to be able to use the Neo1973 as a HID device, being able to use it as controller for presentations.

=== OBEX ===

=== Networking ===

Bluetooth should behave just like our usbnet and provide full TCP/IP access to the phone.  BNEP has to be used.

On the laptop:
* Start bluetooth
 elara /home/alphaone # /etc/init.d/bluetooth start

* Start pand as server
 elara /home/alphaone # pand -s

* As soon as pand is started on the phone configure your IP address
 elara /home/alphaone # ip a add 10.0.0.1/24 dev bnep0
 elara /home/alphaone # ip l set bnep0 up

* Configure IP forwarding and masquerading to your liking

On the phone:

* Power on bluetooth (see above)

* Scan for the laptop
 root@fic-gta01:~$ hcitool scan
 Scanning ...
         00:0E:6D:C0:0l:6A       Sho
         00:20:E0:5A:FE:C8       BlueZ (0)

* Connect to the laptop pand
 root@fic-gta01:~$ pand -c 00:20:E0:5A:FE:C8

* Configure your IP address
 ip a add 10.0.0.2/24 dev bnep0
 ip r add default via 10.0.0.1

* Enjoy
 root@fic-gta01:~$ wget http://www-public.tu-bs.de:8080/~y0019680/tmp/thereisnophone.mp3 
 Connecting to www-public.tu-bs.de[134.169.9.108]:8080
 thereisnophone.mp3   100****************************************************|   266 KB 00:00:00 ETA
 root@fic-gta01:~$ madplay thereisnophone.mp3 
 MPEG Audio Decoder 0.15.2 (beta) - Copyright (C) 2000-2004 Robert Leslie et al.
 630 frames decoded (0:00:22.6), -0.9 dB peak amplitude, 0 clipped samples

=== A2DP ===

The A2DP codec, SBC, runs pretty well now in 32-bit fixed-point math. It's been successfully tested on a faster ARM but not yet on neo. There is test code in the bluetooth-alsa.sf.net plugz module for using alsa plugins to send A2DP audio out and it's starting to be reimplemented "properly" in the bluez core.

=== Headset Audio ===

Bluez has an audio daemon for headset audio that should work to set up the control connection to the headset. It will need hooks in the openmoko gui.

[[Neo1973_Audio_Subsystem]] has more detail about what magic needs to happen with the Wolfson codec so system audio can be switched to use the bluetooth audio channel and later back to the speaker/earpiece/wired headset.

There seems to be a proposal for audio scenario management there but no detail about whether that is how things are done currently. How should audio management work when eg plugging in/unplugging the wired headset?

== Further reading ==

http://www.holtmann.org/papers/bluetooth/ols2006_slides.pdf
http://wiki.bluez.org/wiki/Audio#org.bluez.Audio



[[Category:Neo1973 Hardware]]
[[Bluetooth]]
