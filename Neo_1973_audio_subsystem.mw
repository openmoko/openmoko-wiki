=== Phase0 Quick Start ===

In my experience this works but what comes out is not stereo and it comes out the speaker and headphones. The wolfson driver has to be loaded late at boot time so it works to name it in /etc/modutils/zound :)

 wget http://opensource.wolfsonmicro.com/~gg/neo1973/stereoout.state
 wget http://www-public.tu-bs.de:8080/~y0019680/tmp/thereisnophone.mp3
 alsactl -f stereoout.state restore
 madplay thereisnophone.mp3

=== Voice Calls ===

==== using phone-internal microphone and speaker ====

This is the default case.

* microphone path
** input: built in microphone attached to wolfson MIC2/MIC2N
** routed from wolfson MIC2/MIC2N to MONO1/MONO2
** arrives at GSM Modem input MICIP/MICIN
* speaker path
** input: GSM Modem attached to wolfson RXN/RXP
** routed from wolfson RXN/RXP to ROUT1/LOUT1
** arrives on LM4857 RIN/LIN
** routed on LM4856 to EP+/EP-

===== Internal Codec Route =====

Neo Mode is GSM Handset
Amp Mode is Call Speaker

* audio path Mic -> GSM
** MIC2/MIC2N
** Mic2 Volume
** ALC Micer Mic2
** Left PGA
** Mic Sidetone Mux [Left PGA]
** Mono Sidetone Volume
** Mono Mixer Sidetone Playback Switch
** Mono Volume
** Mono 2 Mux [Inverted Mono 1]

* audio path GSM -> Speaker
** RXP/RXN
** Rx Mixer [RXP - RXN]
** Line Left Mux [Rx Mix]/Line Right Mux [Rx Mix]
** Left Mixer Bypass Playback Switch/Right Mixer Bypass Playback Switch
** Headphone Volume

===== Driver Status =====

This should be supported by ASoC 0.13rc3 (-moko7 kernel) on.

ASoC 0.13.3 should have same functionality but has renamed the soundcard to neo1973.

===== asound.state =====

https://people.openmoko.org/laforge/gta01/gta01b_v2/alsa/gsmhandset.state

For ASoC 0.13.3 http://opensource.wolfsonmicro.com/~gg/neo1973/gsmhandset.state

==== using analog (4pin 2.5mm) headset ====

This is also a quite common case, since we ship the headset with the
phone

Headset Detection is done via GPIO on S3C2410

* microphone path
** input: headset mic vial HS_MIC attached to wolfson MIC1
** routed from wolfson MIC1 to MONO1/MONO2
** arrives at GSM Modem input MICIP/MICIN
* speaker path
** input: GSM Modem attached to wolfson RXN/RXP
** routed from wolfson RXN/RXP to ROUT1/LOUT1
** arrives on LM4857 RIN/LIN
** routed on LM4856 to LHP/RHP

===== Internal Codec Route =====

Neo Mode is GSM Headset
Amp Mode is Headphones

* audio path Mic -> GSM
** MIC1
** Mic Selection Mux [Mic 1]
** ALC Mixer Mic1
** Left PGA
** Mic Sidetone Mux [Left PGA]
** Mono Sidetone Volume
** Mono Mixer Sidetone Playback Switch
** Mono Volume
** Mono 2 Mux [Inverted Mono 1]

* Audio path GSM -> Headphones
** RXP/RXN
** Rx Mixer [RXP - RXN]
** Line Left Mux [Rx Mix]/Line Right Mux [Rx Mix]
** Left Mixer Bypass Playback Switch/Right Mixer Bypass Playback Switch
** Headphone Volume

===== Driver Status =====

Supported in ASoC 0.13.3

===== asound.state =====

http://opensource.wolfsonmicro.com/~gg/neo1973/gsmheadset.state

==== using Bluetooth headset with GSM ====

Headset detection via software

* microphone path
** input: from bluetooth via PCM interface to wolfson
** wolfson: DAC
** wolfson routes analog signal to MONO1/MONO2
** arrives at GSM Modem input MICIP/MICIN
* speaker path
** input: GSM Modem attached to wolfson RXN/RXP
** wolfson: ADC
** wolfson: routes digital signal to PCM
** arrives on bluetooth chip via PCM

===== Internal Codec Route =====

Neo Mode is GSM Bluetooth
Amp Mode is Off

* audio path BT -> GSM
** Vx DAC
** Mono Voice Volume
** Mono Mixer Voice Playback Switch
** Mono Volume
** Mono 2 Mux [Inverted Mono 1]

* audio path GSM -> BT
** RXP/RXN
** Rx Mixer [RXP - RXN]
** ALC Mixer Rx
** Left PGA
** Capture Mixer Mux [PGA]
** Capture Left Mixer [Analogue Mix Left]
** Left ADC

===== Driver Status =====

Should be support by ASoC 0.13.3

Example of how to setup PCM->BT link.

http://opensource.wolfsonmicro.com/~gg/bluetooth-pcm/bluetooth_pcm.c

===== asound.state =====

http://opensource.wolfsonmicro.com/~gg/neo1973/gsmbluetooth.state

==== using Bluetooth headset with system audio ====

For example, using a voip app on the phone with a bt voice headset. This would also be a good way to work on the bluetooth driver without requiring a working GSM and placing a lot of calls.

See ticket 583 for a state file that should route system audio *out* to the headset. The codec does not allow for duplex system audio connected to a headset, so audio in is still using the mic.

=== Multimedia ===

==== sound playback to speakers ====

This is an important mode since it is also required for ringtone
playback

* speaker path 
** input: from S3C2410 via IIS interface to wolfson
** wolfson: DAC
** wolfson: route to ROUT1/LOUT1
** LM4857: arrives on RIN/LIN
** LM4857: route to LLS+-/RLS+-

===== Driver Status =====

This is working since ASoC 0.13rc2 (-moko6 kernel)

This should also work on ASoC 0.13.3

===== asound.state =====

https://people.openmoko.org/laforge/gta01/gta01b_v2/alsa/stereoout.state

For ASoC 0.13.3 http://opensource.wolfsonmicro.com/~gg/neo1973/stereoout.state

==== sound playback to headphone ====

* speaker path
** input: from S3C2410 via IIS interface to wolfson
** wolfson: DAC
** wolfson: route to ROUT1/LOUT1
** LM4857: arrives on RIN/LIN
** routed on LM4856 to LHP/RHP

===== Driver Status =====

This is working since ASoC 0.13rc2 (-moko6 kernel)

==== sound playback via A2DP ====

The current proposal is for bluez to provide a libalsa plugin which either sends audio to the real audio device or encodes and transmits it over bluetooth. The plugin would watch for headset connect/disconnect events generated by a bluez audio daemon.

===== Driver Status =====

UNKNOWN

==== voice recording ==== 

This is mainly used to record notes

* microphone path
** can be from built-in mic
** or from headset
** or bluetooth headset

===== Driver Status =====

UNKNOWN

=== Call recording ===

This is a nice wishlist item.  The user should be able to receive the
full-duplex audio from the wolfson codec, and record it using the
S3C2410 IIS.  

==== recording ====

FIXME
===== Driver Status =====

UNKNOWN
==== playback ====

FIXME
===== Driver Status =====

UNKNOWN

== Userspace Sound Control Daemon ==

The userspace sound control deamon might be a separate process or (more likely) part of some larger general hardware management daemon.


It will provide the following features:

=== audio playback ===

In order to provide the desired functionality, the daemon first needs to be capable of doing audio playback.

* supported formats
** mp3 (libmad)
** ogg/vorbis (libtremor)
** mod (mikmod)
** sid (sidplay)
* supported functionality
** start and stop playback
** interrupt previous sound to play new sound
** enqueue new sound at end of previous sound
** smooth fade-in/fade-out

=== audio event management ===
* manage a set of events (basically just a name for each event)
* manage a set of audio themes
** each theme contains list of event->audio_file_name mappings
** themes stored/managed via gconf
* manage event sources
** built-in event sources, e.g. touchscreen/button press
** external event sources (e.g. gsmd, dbus, ...)

=== audio scenario management ===
* e.g. dialer or even gsmd can request audio subsystem to switch to voicecall mode
* this mainly affects codec/amplifier analog audio routing
* integrated with bluetooth in case of BT headset or A2DP use
* How is this management performed currently?

== Important issues/pitfalls ==

=== Ringtone while headset playback ===

If the user is listening to music on the headset, do we want to mix the
ring tones only into the headset audio, or actually interrupt and play it
on the speaker?

=== More details with using a bluetooth headset ===

There doesn't seem to be a capturebluetooth.state file so one could listen to system audio, for example internet radio, on a bluetooth headset.

The bluetooth_pcm.c example above for using a bluetooth headset does not seem to change the codec mode.
