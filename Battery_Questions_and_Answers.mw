Openmoko devices
Battery questions and answers

NB: Some of the described behaviour depends on the kernel, the
relevant code was pushed on 02 Aug to andy-tracking


Hardware capabilities

Q: What batteries can be used with gta01 and gta02?
A: Original OM gta01, gta02, Nokia BL-5C, BL-6C and compatibles.

Q: Do other BL-5/6C compatible batteries fit?
A: If the battery is thicker than BL-6C, you won't be able to close
the back cover.

Q: What is the difference between all those types?
A: 

Capacity:
gta01, gta02		- 1200 mAh
BL-5C old (newer/new)	- 850 (970/1050) mAh
BL-6C			- 1150 mAh

Temperature control:
gta01, BL-5C, BL-6C	- thermistor
gta02			- bq27000

Special features:
gta02 - accurate and sophisticated reporting of capacity,
time_to_full, time_to_empty, temperature and battery current during
both charge and discharge thanks to bq27000 (aka Coloumb Counter)

Q: What are hardware capabilities of gta01 and gta02 with regard to
battery management?
A:

gta01: charging all battery types, measuring temperature with
battery-integrated thermistor (currently charging and measuring
temperature for non-gta01 batteries doesn't work due to the kernel
driver issues but it's software limitation), measuring battery output
voltage, very inaccurate and noisy measuring of battery current

gta02: charging all battery types, measuring battery output voltage,
communicating with bq27000

Q: Can nokia phones use/charge gta01/gta02 batteries?
A: gta01 and gta02 batteries will fit wherever BL-6C fits but they
can't be charged in nokia phones unless you isolate the middle pin
from the battery and connect a resistor of ~50k (actual measured value
on a cold (25C) battery is 75k, on a slightly warm battery - 82k) from
it to the ground (to fake a thermistor presence).

Q: Can third-party chargers charge gta01/gta02 batteries?
A: The "good" ones will most probably require the same trick needed
for nokia phones. More cheaper ones are more likely to ignore
thermistor absence. 

Q: I have several compatible batteries. What are the storage
requirements for them?
A: Keep in a dry cool place charged to no more than 75%.


Safety issues

Q: Do OM devices control temperature to stop charging if the battery
gets too hot?
A: No (probably gta01 does, need to check).

Q: Isn't it dangerous?
A: No, since all batteries (not raw cells!) have an integrated
protection circuits.

Q: Can i use that fancy 2800 mAh BL-5C-compatible battery i saw on
ebay?
A: Unless you want an explosion in your pocket i wouldn't recommend
using any battery that is not produced by a reputable vendor and
widely tested. And even reputable vendors make mistakes, nokia once
had to recall 46 million batteries manufactured by Matsushita (
http://batteryreplacement.nokia.com/batteryreplacement/en/advisory-2007.html
).

Q: You say that BL-5C is compatible with my gta02. Does that mean i
can use that BL-5C-compatible bat i bought for a buck from a bum?
A: You bet, go ahead.


Charging

Q: My battery charges to 100% but then charging stops and the battery
keeps discharging, wtf?
A: LiIon batteries don't like to be kept fully charged, so the charger
stops as soon as charging current becomes less than threshold. If you
have GSM on it will discharge the battery.

Q: But why doesn't it ever stop charging on my device?
A: The GSM modem is connected directly to the battery terminals so if
it's active, charger will think it's still charging the battery and
won't turn off unless GSM becomes inactive. The default threshold is
about 16mA, the latest Qi increases the threshold to ~32mA.

Q: Does it mean if i leave my phone plugged it will eventually fully
discharge the battery?
A: On gta02 the charger will restart the charge automatically once the
battery voltage reaches ~4V which corresponds to ~76%. Not sure about
gta01, requires more investigation. :-/

Q: Ok, how to make sure my battery is fully charged before a long
trip?
A: Replug the charger, it will trigger charging no matter what the
current capacity is.

Q: My power/aux LED indicates charging/discharging/whatever, what does
that mean (aka why it's still blue even after i unplugged the
charger)?
A: Ask FSO guys about it, some of them think that the user shouldn't
really know what's happening and therefore they do some special
mangling of "status" sysfs node before presenting it to the user. If
you want to make a decent bugreport please add clear steps to
reproduce and /sys/class/power_supply/battery/uevent contents for all
relevant states.


Using compatible batteries with gta02

Q: So, how do i use "dumb" batteries with my freerunner?
A:

First you need to unbind bq27000 driver:
echo bq27000-battery.0 > /sys/bus/platform/drivers/bq27000-battery/unbind

Then you load the dumb battery driver:
modprobe gta01_battery

If you need to use bq27000 driver again, do:
rmmod gta01_battery
echo bq27000-battery.0 > /sys/bus/platform/drivers/bq27000-battery/bind

If you use Enlightment you might need to restart it after that.

Q: Is capacity reported for dumb batteries accurate?
A: During discharge it should be pretty (+-10%) accurate, during
charge the capacity reported is ~20% more than real.

Q: Why does /sys/class/power_supply/battery/charge_full says i have a
850 mAh battery no matter what i use?
A: It's a workaround to make popular battery gadgets work with this
driver.


This Q&A were prepared by
Paul Fertser <fercerpav@gmail.com>
Joerg Reisenweber <joerg@openmoko.org>
